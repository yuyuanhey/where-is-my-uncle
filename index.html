<!DOCTYPE html>
<html>
<head>
<title>輸入地址轉換經緯度</title>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVeEvk0QfpazTPlMzgbCL2sBRRjQjOyaQ"
  type="text/javascript"></script>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<script>
    var i, split;
    var lat, lng;
    var myurl = "https://api.darksky.net/forecast/d7a41975c56dc7ca6fb665df24d9f535/";
    function trans() {
        i = 0;
        $("#target").val("");
        var content = $("#source").val();
        addressToLatLng(content);
    }
    function addressToLatLng(addr) {
        var geocoder = new google.maps.Geocoder();
        
        geocoder.geocode({
            "address": addr
        }, function (results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                var content = $("#target").val();
                lat = results[0].geometry.location.lat();
                lng = results[0].geometry.location.lng();
                $("#target").html( lat + "," + lng );
                myurl += (lat +"," + lng);

                $.ajax({
                    type: 'GET',
                    url: myurl,
                    dataType: 'jsonp',
                    contentType: "application/json",
                    // data: myurl,
                    success: function(data){
                        //完成之後的callback，data為上面的值
                        console.log(data);
                        var now = Date.now() / 1000;
                        var temp = data.hourly.data[0].time;
                        $("#target").append("<div>" + now + "</div>");
                        $("#target").append("<div>" + temp + "</div>");
                        $("#target").append("<div>" + (now - temp) + "</div>");
                    },
                    error: function(e) {
                        alert('Ajax request 發生錯誤');
                    },
                });
                console.log(myurl);
            } else {
                var content = $("#target").val();
                $("#target").html("查無經緯度" + "\n");
            }
        });
        //ajax get method callback return
        // var url = "https://api.darksky.net/forecast/d7a41975c56dc7ca6fb665df24d9f535/"+ lat +"," + lng;
        // console.log(url);
    }
    
</script>
</head>

<body>
		<div>請輸入地址:</div>
		<input name="S1" id="source">台北市信義區市府路1號</input>
        <input type="button" value="CHANGE" id="btn" onclick="trans();">
        <div id="target"></div>
</body>


<!-- <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script> -->
<script>
    function output(print) {
        // var print = this.val();
        // var print =  $('body').contents().find('div #target').html();
        console.log(print);
    }
</script>
</html>